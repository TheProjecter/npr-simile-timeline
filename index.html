<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
<title>SIMILE Timeline of Stories from NPR</title>

<script language="javascript" TYPE="text/javascript">
window.station="KJZZ_FM";
window.localize=true;
</script>

<script src="http://simile.mit.edu/timeline/api/timeline-api.js" type="text/javascript"></script>

<script src="/scripts/jsonStringify.js" type="text/javascript"></script>

<script src="/scripts/json2.js" type="text/javascript"></script>

<script src="http://api.npr.org/query?id=1102&fields=title,teaser,storyDate,audio,image,summary&action=Or&output=JSON&apiKey=MDAxNzgwMDQ5MDEyMTQ4NzYyMjU4YmY1Yw004&callback=ws_results" type="text/javascript"></script>

<script language="javascript" TYPE="text/javascript">

function ws_results(obj) {
	alert(obj.list.title.$text);
}
</script>



<script language="javascript" TYPE="text/javascript">


// pause script to pause computer
// http://www.sean.co.uk/a/webdesign/javascriptdelay.shtm
function pausecomp(millis)
{
var date = new Date();
var curDate = null;

do { curDate = new Date(); }
while(curDate-date < millis);
} 


var jsondata;
url = "http://johntynan.com/scripts/timeline/nprdata.js"

// url = "http://api.npr.org/query?id=1102&fields=title,teaser,storyDate,audio,image,summary&action=Or&output=JSON&apiKey=MDAxNzgwMDQ5MDEyMTQ4NzYyMjU4YmY1Yw004";

// var jsondata = JSON.parse(jsondata);

var http_request = new XMLHttpRequest();
http_request.open( "GET", url, true );


// pause script to load file?
pausecomp(6000);

// this http_request script is right out of wikipedia:
// http://en.wikipedia.org/wiki/JSON

http_request.onreadystatechange = function () {
    if ( http_request.readyState == 4 ) {
        if ( http_request.status == 200 ) {
			// alert(http_request.responseText);
            // jsondata = eval( "(" + http_request.responseText + ")" );
			
			// use json2.js / JSON.parse instead of eval
			jsondata = JSON.parse(http_request.responseText);
			// alert(jsondata);

			// how to turn JSON data into a string
			// http://www.sitepoint.com/forums/showthread.php?t=522950
			// http://www.thomasfrank.se/json_stringify_revisited.html

			//var jsonstring=JSONstring.make(jsondata);
			// var jsonstring=JSONstring.make(jsondata.list.title.$text);
			// var jsonstring=JSONstring.make(jsondata.list.title.$text);
			// var jsonstring=JSONstring.make(jsondata.list.story[0]);
			var jsonstring=JSONstring.make(jsondata.list.story[0].link);

			// document.writeln(jsonstring);			
			// alert(jsonstring);
			
			// call function to convert jsondata into timeline format:
			timelineConverter(jsondata);

        } else {
            alert( "There was a problem with the URL." );
        }
        http_request = null;
    }
};
http_request.send("")

// alert(JSONstring.make(jsondata.list.story[0].link);

newtimeline = []

function timelineConverter(newjsondata){
	// newjsondata = JSON.parse(newjsondata);
	// alert(JSONstring.make(newjsondata));

	var entries = newjsondata.list;
	// alert(entries);
	// alert(JSONstring.make(entries));

	var x;
	// for (x = 0; x < newjsondata.count ; x++){
	// for (x = 0; x < entries.count ; x++){
	for (x = 0; x < 3 ; x++){

 
		// alert(x);
		// alert(newjsondata.list.count);
		// var buildstring = (newjsondata.list.story[x]);
		// var buildstring = (newjsondata.list.story[x].link);
		// var buildstring = (entries.story[x].link[0].$text);
		// var buildstring = (entries.story[x].title.$text);
		// var buildstring = (entries.story[x].storyDate.$text);
		var buildstring = (entries.story[x].teaser.$text);
		// alert(JSONstring.make(buildstring));
		buildstring = null;
		nprico = "http://npr.org/favicon.ico"
		// newtimeline[x] = {link: entries.story[x].link[0].$text, title: entries.story[x].title.$text, start: entries.story[x].storyDate.$text, headline: entries.story[x].teaser.$text, image: nprico};
		if(x == 0)
		{
		newtimeline[x] = {'dateTimeFormat': 'iso8601', 'wikiURL': "http://simile.mit.edu/shelf/",'wikiSection': "Simile Timeline of Stories from NPR", 'events' : {link: entries.story[x].link[0].$text, title: entries.story[x].title.$text, start: entries.story[x].storyDate.$text, headline: entries.story[x].teaser.$text, image: nprico}};
		}
		else
		{
		newtimeline[x] = {'events' : {link: entries.story[x].link[0].$text, title: entries.story[x].title.$text, start: entries.story[x].storyDate.$text, headline: entries.story[x].teaser.$text, image: nprico}};
		}
	}
	// alert(JSONstring.make(newtimeline));

loadNewTimeline(newtimeline);

}


        function loadNewTimeline(newtimeline) {
	var buildstring = newtimeline;
	// var buildstring = (newtimeline[0].title);
	alert(JSONstring.make(buildstring));
	var eventSource = new Timeline.DefaultEventSource(0);
            
            var theme = Timeline.ClassicTheme.create();
            theme.event.bubble.width = 320;
            theme.event.bubble.height = 220;
            var d = Timeline.DateTime.parseGregorianDateTime("2008")
            var bandInfos = [
                Timeline.createBandInfo({
                    width:          "100%", 
                    intervalUnit:   Timeline.DateTime.DECADE, 
                    intervalPixels: 200,
                    eventSource:    eventSource,
                    date:           d,
                    theme:          theme
                })
            ];

	tl = Timeline.create(document.getElementById("tl"), bandInfos, Timeline.HORIZONTAL);
	// tl.loadJSON(newtimeline, function(json, url) {
	// tl.loadJSON(newtimeline, function(json) {
	// eventSource.loadJSON(json, url);
	// eventSource.loadJSON(json);
	eventSource.addMany(newtimeline);
	// tl.loadJSON(newtimeline);
	// eventSource.loadJSON(newtimeline);
}

</script>

<script language="javascript" TYPE="text/javascript">
// from the simile cubism tutorial
// http://simile.mit.edu/timeline/examples/cubism/cubism.html

        var tl;
        function onLoad() {
            var eventSource = new Timeline.DefaultEventSource(0);
            
            var theme = Timeline.ClassicTheme.create();
            theme.event.bubble.width = 320;
            theme.event.bubble.height = 220;
            var d = Timeline.DateTime.parseGregorianDateTime("1900")
            var bandInfos = [
                Timeline.createBandInfo({
                    width:          "100%", 
                    intervalUnit:   Timeline.DateTime.DECADE, 
                    intervalPixels: 200,
                    eventSource:    eventSource,
                    date:           d,
                    theme:          theme
                })
            ];
            
            tl = Timeline.create(document.getElementById("tl"), bandInfos, Timeline.HORIZONTAL);
            tl.loadJSON("cubism.js", function(json, url) {
                eventSource.loadJSON(json, url);
            });
        }
        var resizeTimerID = null;
        function onResize() {
            if (resizeTimerID == null) {
                resizeTimerID = window.setTimeout(function() {
                    resizeTimerID = null;
                    tl.layout();
                }, 500);
            }
        }

</script>




</head>
<body onload="onLoad();" onresize="onResize();" >

<h1 style="text-transform: capitalize;">Timeline</h1>


<div id="body">

    <div id="tl" class="timeline-default" style="height: 300px;">
    </div>

</div>
</body>
</html>